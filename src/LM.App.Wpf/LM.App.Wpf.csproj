<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <!-- keep your target; net8.0-windows or net9.0-windows are both fine -->
    <TargetFramework>net9.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <UseWindowsForms>true</UseWindowsForms>
    <Nullable>enable</Nullable>
    <!-- Enable Windows targeting when building on non-Windows agents -->
    <EnableWindowsTargeting>true</EnableWindowsTargeting>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\LM.Core\LM.Core.csproj" />
    <ProjectReference Include="..\LM.HubAndSpoke\LM.HubSpoke.csproj" />
    <ProjectReference Include="..\LM.Infrastructure\LM.Infrastructure.csproj" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Docnet.Core" />
    <PackageReference Include="PdfiumViewer.WPF" />
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" />
    <PackageReference Include="Microsoft.Extensions.Hosting" />
    <PackageReference Include="CommunityToolkit.Mvvm" />
    <PackageReference Include="Microsoft.Xaml.Behaviors.Wpf" />
    <PackageReference Include="Tesseract" />
    <PackageReference Include="Tabula" />
  </ItemGroup>

  <ItemGroup>
    <!-- Roslyn analyzer that tracks public surface via PublicAPI.*.txt -->
    <PackageReference Include="Microsoft.CodeAnalysis.PublicApiAnalyzers">
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>

    <!-- Make the API files visible in Solution Explorer -->
    <AdditionalFiles Include="PublicAPI.Shipped.txt" />
    <AdditionalFiles Include="PublicAPI.Unshipped.txt" />
  </ItemGroup>

  <PropertyGroup>
    <!-- Temporary suppression for RS0017 until the analyzer recognizes EditEntryAsync in PublicAPI.Unshipped.txt -->
    <NoWarn>$(NoWarn);RS0017</NoWarn>
  </PropertyGroup>

  <Target Name="EnsurePdfiumViewerRuntime" AfterTargets="CopyFilesToOutputDirectory">
    <PropertyGroup>
      <_PdfiumX64Source>$(OutDir)x64\pdfium.dll</_PdfiumX64Source>
      <_PdfiumX86Source>$(OutDir)x86\pdfium.dll</_PdfiumX86Source>
      <_PdfiumDestination>$(OutDir)pdfium.dll</_PdfiumDestination>
    </PropertyGroup>

    <!-- Prefer the PdfiumViewer-provided binary when present to avoid Docnet's legacy build. -->
    <Copy
      SourceFiles="$(_PdfiumX64Source)"
      DestinationFiles="$(_PdfiumDestination)"
      OverwriteReadOnlyFiles="true"
      SkipUnchangedFiles="false"
      Condition="Exists('$(_PdfiumX64Source)')" />

    <!-- Fall back to the 32-bit runtime if that is the only asset produced. -->
    <Copy
      SourceFiles="$(_PdfiumX86Source)"
      DestinationFiles="$(_PdfiumDestination)"
      OverwriteReadOnlyFiles="true"
      SkipUnchangedFiles="false"
      Condition="!Exists('$(_PdfiumX64Source)') and Exists('$(_PdfiumX86Source)')" />
  </Target>

  <ItemGroup>
    <Folder Include="Application\" />
    <Folder Include="ViewModels\Library\" />
    <Folder Include="ViewModels\Review\" />
  </ItemGroup>

  <!-- Create empty API files automatically if they are missing -->
  <Target Name="EnsurePublicApiFiles" BeforeTargets="Build">
    <WriteLinesToFile File="PublicAPI.Shipped.txt" Lines="" Overwrite="false" Condition="!Exists('PublicAPI.Shipped.txt')" />
    <WriteLinesToFile File="PublicAPI.Unshipped.txt" Lines="" Overwrite="false" Condition="!Exists('PublicAPI.Unshipped.txt')" />
  </Target>

  <PropertyGroup>
    <EnableNETAnalyzers>true</EnableNETAnalyzers>
    <AnalysisLevel>latest</AnalysisLevel>
  </PropertyGroup>
</Project>
