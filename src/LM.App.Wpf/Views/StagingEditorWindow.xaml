<Window x:Class="LM.App.Wpf.Views.StagingEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:core="clr-namespace:LM.Core.Models;assembly=LM.Core"
        mc:Ignorable="d"
        Title="Review staged items"
        Height="520"
        Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
  <Window.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/LM.App.Wpf;component/Views/Templates/StagingEditorTemplates.xaml" />
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </Window.Resources>

  <Grid Margin="12" DataContext="{Binding StagingList}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <StackPanel Grid.Row="0"
                Orientation="Horizontal"
                Margin="0,0,0,8"
                VerticalAlignment="Center">
      <TextBlock Text="Review and edit metadata" FontWeight="Bold" />
      <TextBlock Text="{Binding IndexLabel}" Margin="12,0,0,0" />

      <TextBlock Text="Type:" Margin="24,0,6,0" VerticalAlignment="Center" />
      <ComboBox ItemsSource="{Binding EntryTypes}"
                SelectedItem="{Binding SelectedType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                Width="150" />

      <Border Background="#FFE0E0E0"
              CornerRadius="4"
              Padding="6,2"
              Margin="16,0,0,0"
              Visibility="{Binding Current.IsDuplicate, Converter={StaticResource BoolToVis}}">
        <TextBlock Text="Exact duplicate in library" Foreground="#FF404040" FontWeight="SemiBold" />
      </Border>

      <Border Background="#FFFDEEB5"
              CornerRadius="4"
              Padding="6,2"
              Margin="8,0,0,0"
              Visibility="{Binding Current.IsNearMatch, Converter={StaticResource BoolToVis}}">
        <TextBlock>
          <Run Text="Near match: " />
          <Run Text="{Binding Current.MatchedTitle}" FontStyle="Italic" />
        </TextBlock>
      </Border>
    </StackPanel>

    <Border Grid.Row="1">
      <Border.Style>
        <Style TargetType="Border">
          <Setter Property="Background" Value="{x:Null}" />
          <Setter Property="Opacity" Value="1" />
          <Setter Property="IsEnabled" Value="True" />
          <Style.Triggers>
            <DataTrigger Binding="{Binding Current.IsDuplicate}" Value="True">
              <Setter Property="Opacity" Value="0.5" />
              <Setter Property="IsEnabled" Value="False" />
              <Setter Property="Background">
                <Setter.Value>
                  <SolidColorBrush Color="#FFF0F0F0" />
                </Setter.Value>
              </Setter>
            </DataTrigger>

            <DataTrigger Binding="{Binding Current.IsNearMatch}" Value="True">
              <Setter Property="Background">
                <Setter.Value>
                  <SolidColorBrush Color="#FFFDEEB5" />
                </Setter.Value>
              </Setter>
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </Border.Style>

      <ContentControl Content="{Binding Current}">
        <ContentControl.Style>
          <Style TargetType="ContentControl">
            <Setter Property="ContentTemplate" Value="{StaticResource DocumentTemplate}" />
            <Style.Triggers>
              <DataTrigger Binding="{Binding Current.Type}" Value="{x:Static core:EntryType.Publication}">
                <Setter Property="ContentTemplate" Value="{StaticResource PublicationTemplate}" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </ContentControl.Style>
      </ContentControl>
    </Border>

    <StackPanel Grid.Row="2"
                Orientation="Horizontal"
                HorizontalAlignment="Right"
                Margin="0,8,0,0">
      <Button Content="◀ Previous"
              Margin="0,0,8,0"
              Command="{Binding DataContext.PrevCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
      <Button Content="Next ▶"
              Margin="0,0,8,0"
              Command="{Binding DataContext.NextCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
      <Button Content="Close"
              Command="{Binding DataContext.CloseCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
    </StackPanel>
  </Grid>
</Window>
