<Window x:Class="LM.App.Wpf.Views.Dialogs.Projects.ProjectCreationWindow"
        x:ClassModifier="internal"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:proj="clr-namespace:LM.App.Wpf.ViewModels.Dialogs.Projects"
        xmlns:common="clr-namespace:LM.App.Wpf.Common"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="820"
        Width="1320"
        Background="#FFF9FAFC"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    <common:StringJoinConverter x:Key="StringJoinConverter" />

    <Style x:Key="StageActionButtonStyle" TargetType="Button">
      <Setter Property="Padding" Value="14,10" />
      <Setter Property="Margin" Value="0,0,8,0" />
      <Setter Property="FontSize" Value="14" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Background" Value="#FF1D4ED8" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderBrush" Value="#FF153FA6" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="HorizontalAlignment" Value="Stretch" />
      <Setter Property="SnapsToDevicePixels" Value="True" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{TemplateBinding CornerRadius}">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="#FF2A5EEA" />
                <Setter Property="BorderBrush" Value="#FF1E40AF" />
              </Trigger>
              <Trigger Property="IsEnabled" Value="False">
                <Setter Property="Background" Value="#FFCBD5F5" />
                <Setter Property="BorderBrush" Value="#FF9AA7E0" />
                <Setter Property="Foreground" Value="#FF5F6B94" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <Style x:Key="SecondaryStageActionButtonStyle" BasedOn="{StaticResource StageActionButtonStyle}" TargetType="Button">
      <Setter Property="Background" Value="White" />
      <Setter Property="Foreground" Value="#FF1D4ED8" />
      <Setter Property="BorderBrush" Value="#FFCBD5F5" />
      <Setter Property="Margin" Value="0,0,0,0" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{TemplateBinding CornerRadius}">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="BorderBrush" Value="#FF93A4E6" />
                <Setter Property="Background" Value="#FFF3F6FF" />
              </Trigger>
              <Trigger Property="IsEnabled" Value="False">
                <Setter Property="Foreground" Value="#FF94A3B8" />
                <Setter Property="BorderBrush" Value="#FFE2E8F0" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <DataTemplate DataType="{x:Type proj:StageScreeningViewModel}" x:Key="StageActionTemplate">
      <StackPanel>
        <TextBlock Text="{Binding Name}"
                   FontSize="20"
                   FontWeight="SemiBold"
                   Foreground="#FF1D2433" />
        <TextBlock Text="{Binding Description}"
                   Margin="0,4,0,16"
                   TextWrapping="Wrap"
                   Foreground="#FF4B5563" />

        <UniformGrid Columns="2" Margin="0,0,0,16" HorizontalAlignment="Stretch">
          <Button Content="{Binding IncludeLabel}"
                  Command="{Binding IncludeCommand}"
                  Style="{StaticResource StageActionButtonStyle}" />
          <Button Content="{Binding ExcludeLabel}"
                  Command="{Binding ExcludeCommand}"
                  Style="{StaticResource SecondaryStageActionButtonStyle}" />
        </UniformGrid>

        <Border Background="#FFF1F5F9"
                BorderBrush="#FFE2E8F0"
                BorderThickness="1"
                CornerRadius="6"
                Padding="12"
                Margin="0,0,0,12">
          <StackPanel>
            <TextBlock Text="Decision"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Foreground="#FF475569" />
            <TextBlock Margin="0,4,0,0"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Foreground="#FF1D4ED8">
              <TextBlock.Style>
                <Style TargetType="TextBlock">
                  <Setter Property="Text" Value="Pending" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding IsIncluded}" Value="True">
                      <Setter Property="Text" Value="Included" />
                      <Setter Property="Foreground" Value="#FF15803D" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsExcluded}" Value="True">
                      <Setter Property="Text" Value="Excluded" />
                      <Setter Property="Foreground" Value="#FFB91C1C" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </TextBlock.Style>
            </TextBlock>
          </StackPanel>
        </Border>

        <StackPanel>
          <TextBlock Text="Screening checklist"
                     FontWeight="SemiBold"
                     Foreground="#FF1F2937" />
          <ItemsControl ItemsSource="{Binding Criteria}" Margin="0,8,0,0">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Padding="10"
                        Margin="0,0,0,6"
                        Background="#FFFFFFFF"
                        BorderBrush="#FFE2E8F0"
                        BorderThickness="1"
                        CornerRadius="6">
                  <StackPanel>
                    <CheckBox Content="{Binding Label}"
                              IsChecked="{Binding IsSelected, Mode=TwoWay}" />
                    <TextBlock Text="{Binding Description}"
                               Margin="20,4,0,0"
                               Foreground="#FF64748B"
                               TextWrapping="Wrap">
                      <TextBlock.Style>
                        <Style TargetType="TextBlock">
                          <Setter Property="Visibility" Value="Visible" />
                          <Style.Triggers>
                            <Trigger Property="Text" Value="">
                              <Setter Property="Visibility" Value="Collapsed" />
                            </Trigger>
                            <Trigger Property="Text" Value="{x:Null}">
                              <Setter Property="Visibility" Value="Collapsed" />
                            </Trigger>
                          </Style.Triggers>
                        </Style>
                      </TextBlock.Style>
                    </TextBlock>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>

        <StackPanel Margin="0,16,0,0"
                    Visibility="{Binding AllowNotes, Converter={StaticResource BoolToVisibility}}">
          <TextBlock Text="Reviewer notes"
                     FontWeight="SemiBold"
                     Foreground="#FF1F2937" />
          <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                   Margin="0,6,0,0"
                   AcceptsReturn="True"
                   MinHeight="80"
                   TextWrapping="Wrap"
                   BorderBrush="#FFCBD5F5"
                   BorderThickness="1"
                   Padding="8" />
        </StackPanel>

        <Button Content="Reset decision"
                Command="{Binding ResetCommand}"
                Margin="0,20,0,0"
                HorizontalAlignment="Left"
                Padding="10,6"
                BorderBrush="#FFE2E8F0"
                Background="White"
                Foreground="#FF475569" />
      </StackPanel>
    </DataTemplate>

    <DataTemplate x:Key="DataExtractionFieldTemplate" DataType="{x:Type proj:DataExtractionFieldViewModel}">
      <StackPanel Margin="0,0,0,16">
        <DockPanel>
          <TextBlock Text="{Binding Label}"
                     DockPanel.Dock="Left"
                     FontWeight="SemiBold"
                     Foreground="#FF1F2937" />
          <TextBlock Text="Required"
                     DockPanel.Dock="Right"
                     FontSize="11"
                     Foreground="#FFB91C1C"
                     Visibility="{Binding IsRequired, Converter={StaticResource BoolToVisibility}}" />
        </DockPanel>
        <ContentControl>
          <ContentControl.Style>
            <Style TargetType="ContentControl">
              <Setter Property="ContentTemplate">
                <Setter.Value>
                  <DataTemplate>
                    <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                             Padding="10"
                             BorderBrush="#FFCBD5F5"
                             BorderThickness="1"
                             Background="White"
                             TextWrapping="Wrap"
                             MinHeight="36"
                             AcceptsReturn="False" />
                  </DataTemplate>
                </Setter.Value>
              </Setter>
              <Style.Triggers>
                <DataTrigger Binding="{Binding TemplateKey}" Value="{x:Static proj:ProjectCreationFieldTemplates.MultiLine}">
                  <Setter Property="ContentTemplate">
                    <Setter.Value>
                      <DataTemplate>
                        <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                 Padding="10"
                                 BorderBrush="#FFCBD5F5"
                                 BorderThickness="1"
                                 Background="White"
                                 MinHeight="96"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap" />
                      </DataTemplate>
                    </Setter.Value>
                  </Setter>
                </DataTrigger>
                <DataTrigger Binding="{Binding TemplateKey}" Value="{x:Static proj:ProjectCreationFieldTemplates.Choice}">
                  <Setter Property="ContentTemplate">
                    <Setter.Value>
                      <DataTemplate>
                        <ComboBox ItemsSource="{Binding Options}"
                                  SelectedItem="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  Padding="6"
                                  Background="White"
                                  BorderBrush="#FFCBD5F5"
                                  BorderThickness="1" />
                      </DataTemplate>
                    </Setter.Value>
                  </Setter>
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </ContentControl.Style>
        </ContentControl>
        <TextBlock Text="{Binding Placeholder}"
                   Foreground="#FF94A3B8"
                   FontSize="11"
                   Margin="4,4,0,0"
                   TextWrapping="Wrap">
          <TextBlock.Style>
            <Style TargetType="TextBlock">
              <Setter Property="Visibility" Value="Visible" />
              <Style.Triggers>
                <Trigger Property="Text" Value="">
                  <Setter Property="Visibility" Value="Collapsed" />
                </Trigger>
                <Trigger Property="Text" Value="{x:Null}">
                  <Setter Property="Visibility" Value="Collapsed" />
                </Trigger>
              </Style.Triggers>
            </Style>
          </TextBlock.Style>
        </TextBlock>
      </StackPanel>
    </DataTemplate>
  </Window.Resources>

  <Grid Margin="24">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="3*" />
      <ColumnDefinition Width="2*" />
    </Grid.ColumnDefinitions>

    <Border Grid.Row="0"
            Grid.ColumnSpan="2"
            Background="White"
            BorderBrush="#FFE2E8F0"
            BorderThickness="1"
            CornerRadius="14"
            Padding="24">
      <Border.Effect>
        <DropShadowEffect Color="#11000000" BlurRadius="18" ShadowDepth="2" />
      </Border.Effect>
      <StackPanel>
        <TextBlock Text="{Binding ProjectName}"
                   FontSize="26"
                   FontWeight="SemiBold"
                   Foreground="#FF111827" />
        <ItemsControl ItemsSource="{Binding Document.Attributes}"
                      Margin="0,12,0,0">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <UniformGrid Columns="3" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <StackPanel>
                <TextBlock Text="{Binding Label}"
                           FontSize="12"
                           Foreground="#FF6B7280" />
                <TextBlock Text="{Binding Value}"
                           FontWeight="SemiBold"
                           Foreground="#FF1F2937" />
              </StackPanel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
        <TextBlock Text="{Binding Document.Authors, Converter={StaticResource StringJoinConverter}}"
                   Margin="0,12,0,0"
                   Foreground="#FF4B5563" />
      </StackPanel>
    </Border>

    <Border Grid.Row="1"
            Grid.Column="0"
            Margin="0,24,24,24"
            Padding="0"
            Background="Transparent">
      <TabControl>
        <TabItem Header="Title &amp; Abstract">
          <Grid Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="1.6*" />
              <ColumnDefinition Width="1*" />
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0"
                    Background="White"
                    BorderBrush="#FFE2E8F0"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="20"
                    Margin="0,0,16,0">
              <ScrollViewer>
                <StackPanel>
                  <TextBlock Text="Abstract"
                             FontSize="18"
                             FontWeight="SemiBold"
                             Foreground="#FF111827" />
                  <TextBlock Text="{Binding DataContext.Document.AbstractText, RelativeSource={RelativeSource AncestorType=TabControl}}"
                             Margin="0,8,0,0"
                             TextWrapping="Wrap"
                             Foreground="#FF4B5563" />
                  <TextBlock Text="Authors"
                             Margin="0,16,0,0"
                             FontWeight="SemiBold"
                             Foreground="#FF111827" />
                  <ItemsControl ItemsSource="{Binding DataContext.Document.Authors, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                Margin="0,6,0,0">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="•  {Binding}"
                                   Foreground="#FF4B5563" />
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                  <TextBlock Text="Keywords"
                             Margin="0,16,0,0"
                             FontWeight="SemiBold"
                             Foreground="#FF111827" />
                  <ItemsControl ItemsSource="{Binding DataContext.Document.Keywords, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                Margin="0,6,0,0">
                    <ItemsControl.ItemsPanel>
                      <ItemsPanelTemplate>
                        <WrapPanel IsItemsHost="True" />
                      </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="#FFE0E7FF"
                                BorderBrush="#FFCBD5F5"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="10,4"
                                Margin="0,0,8,8">
                          <TextBlock Text="{Binding}"
                                     Foreground="#FF1D4ED8" />
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </ScrollViewer>
            </Border>
            <Border Grid.Column="1"
                    Background="White"
                    BorderBrush="#FFE2E8F0"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="20">
              <ContentControl Content="{Binding DataContext.TitleAbstractStage, RelativeSource={RelativeSource AncestorType=TabControl}}"
                              ContentTemplate="{StaticResource StageActionTemplate}" />
            </Border>
          </Grid>
        </TabItem>
        <TabItem Header="Full Text">
          <Grid Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="1.7*" />
              <ColumnDefinition Width="1*" />
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0"
                    Background="White"
                    BorderBrush="#FFE2E8F0"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="0"
                    Margin="0,0,16,0">
              <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding DataContext.PdfPages, RelativeSource={RelativeSource AncestorType=TabControl}}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border Margin="24"
                              Background="#FFF8FAFF"
                              BorderBrush="#FFE0E7FF"
                              BorderThickness="1"
                              CornerRadius="12"
                              Padding="18">
                        <StackPanel>
                          <TextBlock Text="Page {Binding PageNumber}"
                                     FontWeight="SemiBold"
                                     Foreground="#FF1D4ED8" />
                          <TextBlock Text="{Binding Caption}"
                                     Margin="0,4,0,0"
                                     FontSize="16"
                                     FontWeight="SemiBold"
                                     Foreground="#FF111827" />
                          <TextBlock Text="{Binding Summary}"
                                     Margin="0,6,0,0"
                                     TextWrapping="Wrap"
                                     Foreground="#FF4B5563" />
                        </StackPanel>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>
            </Border>
            <Border Grid.Column="1"
                    Background="White"
                    BorderBrush="#FFE2E8F0"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="20">
              <ContentControl Content="{Binding DataContext.FullTextStage, RelativeSource={RelativeSource AncestorType=TabControl}}"
                              ContentTemplate="{StaticResource StageActionTemplate}" />
            </Border>
          </Grid>
        </TabItem>
      </TabControl>
    </Border>

    <Border Grid.Row="1"
            Grid.Column="1"
            Margin="0,24,0,24"
            Padding="20"
            Background="White"
            BorderBrush="#FFE2E8F0"
            BorderThickness="1"
            CornerRadius="12"
            Visibility="{Binding IsDataExtractionVisible, Converter={StaticResource BoolToVisibility}}">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel>
          <TextBlock Text="Data extraction template"
                     FontSize="20"
                     FontWeight="SemiBold"
                     Foreground="#FF0F172A" />
          <TextBlock Text="Captured only after inclusion at both screening stages"
                     Margin="0,4,0,16"
                     Foreground="#FF4B5563" />
          <ItemsControl ItemsSource="{Binding DataExtractionGroups}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border BorderBrush="#FFD9E0F5"
                        BorderThickness="1"
                        CornerRadius="10"
                        Margin="0,0,0,16"
                        Padding="16">
                  <StackPanel>
                    <TextBlock Text="{Binding Name}"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="#FF1F2937" />
                    <ItemsControl ItemsSource="{Binding Fields}"
                                  ItemTemplate="{StaticResource DataExtractionFieldTemplate}"
                                  Margin="0,12,0,0" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </ScrollViewer>
    </Border>

    <StackPanel Grid.Row="2"
                Grid.ColumnSpan="2"
                Orientation="Horizontal"
                HorizontalAlignment="Right"
                Margin="0,12,0,0">
      <Button Content="Cancel"
              Command="{Binding CancelCommand}"
              Padding="20,10"
              Margin="0,0,12,0"
              Background="White"
              BorderBrush="#FFE2E8F0"
              BorderThickness="1"
              Foreground="#FF4B5563" />
      <Button Content="Create project"
              Command="{Binding SaveCommand}"
              Padding="24,10"
              Background="#FF2563EB"
              Foreground="White"
              BorderBrush="#FF1E40AF"
              BorderThickness="1" />
    </StackPanel>
  </Grid>
</Window>
