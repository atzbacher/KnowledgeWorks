<Window x:Class="LM.App.Wpf.Views.Review.StageWorkspacePreviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:LM.App.Wpf.ViewModels.Review"
        mc:Ignorable="d"
        Title="Workspace preview"
        Height="720"
        Width="1200"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner"
        Background="#F9FAFB"
        d:DataContext="{d:DesignInstance Type=vm:StageWorkspacePreviewViewModel}">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
  </Window.Resources>

  <Grid Margin="24">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
      <TextBlock Text="{Binding StageName}"
                 FontSize="26"
                 FontWeight="Bold" />
      <Border Background="#EEF2FF"
              BorderBrush="#C7D2FE"
              BorderThickness="1"
              CornerRadius="16"
              Padding="12,4"
              Margin="16,0,0,0">
        <TextBlock Text="{Binding StageType}" Foreground="#1D4ED8" FontWeight="SemiBold" />
      </Border>
    </StackPanel>

    <TextBlock Grid.Row="1"
               Text="{Binding StageSubtitle}"
               Foreground="#4B5563"
               FontSize="16"
               Margin="0,6,0,0" />

    <Grid Grid.Row="2" Margin="0,24,0,0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="{Binding LeftColumnWidth}" />
        <ColumnDefinition Width="20" />
        <ColumnDefinition Width="{Binding DecisionColumnWidth}" />
        <ColumnDefinition Width="20" />
        <ColumnDefinition Width="{Binding ExtractionColumnWidth}" />
      </Grid.ColumnDefinitions>

      <Border Grid.Column="0"
              Background="#FFFFFFFF"
              BorderBrush="#E5E7EB"
              BorderThickness="1"
              CornerRadius="12"
              Padding="20"
              Visibility="{Binding HasLeftPane, Converter={StaticResource BooleanToVisibilityConverter}}">
        <StackPanel>
          <Border Background="#F9FAFB"
                  BorderBrush="#E5E7EB"
                  BorderThickness="1"
                  CornerRadius="10"
                  Padding="16"
                  Margin="0,0,0,16"
                  Visibility="{Binding HasBibliographySummary, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
              <TextBlock Text="Bibliography summary" FontWeight="SemiBold" />
              <TextBlock Text="Understanding telehealth adoption for chronic care"
                         FontSize="18"
                         FontWeight="SemiBold"
                         Margin="0,8,0,0" />
              <TextBlock Text="H. Miller • K. Singh • A. Roberts"
                         Foreground="#6B7280"
                         Margin="0,4,0,0" />
              <Border Background="#EEF2FF"
                      CornerRadius="6"
                      Padding="10"
                      Margin="0,12,0,12">
                <TextBlock Text="Hospitals implementing remote monitoring programmes observed improved adherence across adult populations. This abstract summarises study design, timeframe, and outcome measures so reviewers can make confident inclusion decisions." 
                           TextWrapping="Wrap"
                           Foreground="#111827" />
              </Border>
              <UniformGrid Columns="3" Margin="0,0,0,4">
                <Border Background="#DBEAFE" CornerRadius="8" Padding="6,3" Margin="0,0,8,8">
                  <TextBlock Text="Randomised" FontWeight="SemiBold" Foreground="#1D4ED8" />
                </Border>
                <Border Background="#DCFCE7" CornerRadius="8" Padding="6,3" Margin="0,0,8,8">
                  <TextBlock Text="Adults" FontWeight="SemiBold" Foreground="#047857" />
                </Border>
                <Border Background="#FCE7F3" CornerRadius="8" Padding="6,3" Margin="0,0,8,8">
                  <TextBlock Text="US" FontWeight="SemiBold" Foreground="#BE185D" />
                </Border>
              </UniformGrid>
            </StackPanel>
          </Border>

          <Border Background="#111827"
                  CornerRadius="12"
                  Padding="12"
                  Height="280"
                  Visibility="{Binding HasFullTextViewer, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
              <Border Background="#1F2937" CornerRadius="8" Opacity="0.65" />
              <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="PDF manuscript preview"
                           Foreground="#E5E7EB"
                           FontSize="18"
                           FontWeight="SemiBold"
                           HorizontalAlignment="Center" />
                <TextBlock Text="Scroll to review highlights and annotations."
                           Foreground="#9CA3AF"
                           Margin="0,6,0,0"
                           HorizontalAlignment="Center" />
                <Button Content="Open source PDF"
                        Padding="18,8"
                        Margin="0,16,0,0"
                        HorizontalAlignment="Center" />
              </StackPanel>
            </Grid>
          </Border>
        </StackPanel>
      </Border>

      <Border Grid.Column="2"
              Background="#FFFFFFFF"
              BorderBrush="#E5E7EB"
              BorderThickness="1"
              CornerRadius="12"
              Padding="20"
              Visibility="{Binding HasDecisionPane, Converter={StaticResource BooleanToVisibilityConverter}}">
        <StackPanel>
          <TextBlock Text="Reviewer decision"
                     FontSize="18"
                     FontWeight="SemiBold" />
          <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
            <Button Content="{Binding PrimaryDecisionLabel}"
                    Padding="18,8"
                    Background="#2563EB"
                    Foreground="White"
                    FontWeight="SemiBold" />
            <Button Content="{Binding SecondaryDecisionLabel}"
                    Padding="18,8"
                    Margin="12,0,0,0"
                    Background="#F9FAFB"
                    BorderBrush="#D1D5DB"
                    FontWeight="SemiBold" />
          </StackPanel>
          <TextBlock Text="{Binding DecisionHint}"
                     Foreground="#4B5563"
                     Margin="0,12,0,0" />

          <Border Background="#F3F4F6"
                  CornerRadius="10"
                  Padding="14"
                  Margin="0,16,0,0"
                  Visibility="{Binding HasInclusionChecklist, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
              <TextBlock Text="PICO(S) inclusion checklist"
                         FontWeight="SemiBold" />
              <ItemsControl ItemsSource="{Binding InclusionChecklist}" Margin="0,10,0,0">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                      <CheckBox IsChecked="True" Margin="0,0,8,0" />
                      <TextBlock Text="{Binding}" />
                    </StackPanel>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </Border>

          <Border Background="#F9FAFB"
                  CornerRadius="10"
                  Padding="14"
                  Margin="0,16,0,0"
                  Visibility="{Binding HasNotesPane, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
              <TextBlock Text="Reviewer notes"
                         FontWeight="SemiBold" />
              <Border BorderBrush="#D1D5DB"
                      BorderThickness="1"
                      CornerRadius="6"
                      Margin="0,8,0,0"
                      Background="White"
                      Padding="12">
                <TextBlock Text="Summarise rationale or highlight follow-up questions. Notes sync across reviewers for consensus rounds."
                           TextWrapping="Wrap"
                           Foreground="#4B5563" />
              </Border>
            </StackPanel>
          </Border>
        </StackPanel>
      </Border>

      <Border Grid.Column="4"
              Background="#FFFFFFFF"
              BorderBrush="#E5E7EB"
              BorderThickness="1"
              CornerRadius="12"
              Padding="20"
              Visibility="{Binding HasExtractionPane, Converter={StaticResource BooleanToVisibilityConverter}}">
        <StackPanel>
          <TextBlock Text="Data extraction workspace"
                     FontSize="18"
                     FontWeight="SemiBold" />
          <TextBlock Text="Fields configured during project setup appear here once a record is included in both screening steps."
                     TextWrapping="Wrap"
                     Foreground="#4B5563"
                     Margin="0,6,0,16" />
          <ItemsControl ItemsSource="{Binding ExtractionFields}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border BorderBrush="#D1D5DB"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="10"
                        Margin="0,0,0,10">
                  <StackPanel>
                    <TextBlock Text="{Binding}" FontWeight="SemiBold" />
                    <TextBlock Text="Add structured data points, quotes, or metrics captured during review."
                               Foreground="#6B7280"
                               Margin="0,4,0,0" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          <Button Content="Design extraction schema"
                  Padding="18,8"
                  Margin="0,12,0,0"
                  Background="#10B981"
                  Foreground="White"
                  FontWeight="SemiBold" />
        </StackPanel>
      </Border>
    </Grid>
  </Grid>
</Window>
