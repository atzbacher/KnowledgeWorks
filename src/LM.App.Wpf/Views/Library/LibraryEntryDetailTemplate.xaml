<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:viewModels="clr-namespace:LM.App.Wpf.ViewModels">
  <ResourceDictionary.MergedDictionaries>
    <ResourceDictionary Source="LibraryCommonResources.xaml" />
  </ResourceDictionary.MergedDictionaries>

  <Style x:Key="SectionHeaderTextStyle" TargetType="TextBlock">
    <Setter Property="FontWeight" Value="SemiBold" />
    <Setter Property="Margin" Value="0,16,0,4" />
  </Style>

  <Style x:Key="SectionTextStyle" TargetType="TextBlock">
    <Setter Property="TextWrapping" Value="Wrap" />
  </Style>

  <Style x:Key="OptionalSectionTextStyle"
         TargetType="TextBlock"
         BasedOn="{StaticResource SectionTextStyle}">
    <Setter Property="Visibility" Value="Visible" />
    <Style.Triggers>
      <Trigger Property="Text" Value="">
        <Setter Property="Visibility" Value="Collapsed" />
      </Trigger>
      <Trigger Property="Text" Value="{x:Null}">
        <Setter Property="Visibility" Value="Collapsed" />
      </Trigger>
    </Style.Triggers>
  </Style>

  <Style x:Key="DisplayNameTextStyle"
         TargetType="TextBlock"
         BasedOn="{StaticResource OptionalSectionTextStyle}">
    <Setter Property="FontStyle" Value="Italic" />
    <Setter Property="Foreground" Value="Gray" />
    <Setter Property="Margin" Value="0,4,0,0" />
  </Style>

  <Style x:Key="OptionalInlineTextStyle" TargetType="TextBlock">
    <Setter Property="Visibility" Value="Visible" />
    <Style.Triggers>
      <Trigger Property="Text" Value="">
        <Setter Property="Visibility" Value="Collapsed" />
      </Trigger>
      <Trigger Property="Text" Value="{x:Null}">
        <Setter Property="Visibility" Value="Collapsed" />
      </Trigger>
    </Style.Triggers>
  </Style>

  <Style x:Key="SectionPlaceholderTextStyle" TargetType="TextBlock">
    <Setter Property="FontStyle" Value="Italic" />
    <Setter Property="Foreground" Value="Gray" />
    <Setter Property="Visibility" Value="Collapsed" />
  </Style>

  <Style x:Key="AttachmentNotesTextStyle"
         TargetType="TextBlock"
         BasedOn="{StaticResource SectionTextStyle}">
    <Setter Property="Visibility" Value="Visible" />
    <Style.Triggers>
      <Trigger Property="Text" Value="">
        <Setter Property="Visibility" Value="Collapsed" />
      </Trigger>
      <Trigger Property="Text" Value="{x:Null}">
        <Setter Property="Visibility" Value="Collapsed" />
      </Trigger>
    </Style.Triggers>
  </Style>

  <Style x:Key="AttachmentTagsTextStyle" TargetType="TextBlock">
    <Setter Property="Visibility" Value="Visible" />
    <Style.Triggers>
      <DataTrigger Binding="{Binding Tags}" Value="{x:Null}">
        <Setter Property="Visibility" Value="Collapsed" />
      </DataTrigger>
      <DataTrigger Binding="{Binding Tags.Count}" Value="0">
        <Setter Property="Visibility" Value="Collapsed" />
      </DataTrigger>
    </Style.Triggers>
  </Style>


  <DataTemplate x:Key="LibraryEntryDetailTemplate"
                DataType="{x:Type viewModels:LibrarySearchResult}">

    <StackPanel>
      <Grid Margin="0,0,0,12">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0">
          <TextBlock Text="{Binding Entry.Title}"
                     FontSize="16"
                     FontWeight="SemiBold"
                     TextWrapping="Wrap" />
          <TextBlock Text="{Binding Entry.DisplayName}"
                     Style="{StaticResource DisplayNameTextStyle}" />
          <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
            <TextBlock Text="{Binding Entry.Type}" />
            <TextBlock Text="{Binding Entry.Year}"
                       Margin="12,0,0,0"
                       Style="{StaticResource OptionalInlineTextStyle}" />
            <TextBlock Text="Internal"
                       Margin="12,0,0,0"
                       Visibility="{Binding Entry.IsInternal, Converter={StaticResource BoolToVisibilityConverter}}" />
          </StackPanel>
        </StackPanel>

        <Button Grid.Column="1"
                Content="Edit"
                Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                Margin="12,0,0,0"
                Padding="12,4"
                HorizontalAlignment="Right"
                VerticalAlignment="Top" />
      </Grid>

      <TextBlock Text="Source" Style="{StaticResource SectionHeaderTextStyle}" />
      <TextBlock Text="{Binding Entry.Source}"
                 Style="{StaticResource SectionTextStyle}"
                 Visibility="{Binding HasSource, Converter={StaticResource BoolToVisibilityConverter}}" />
      <TextBlock Text="No source recorded.">
        <TextBlock.Style>
          <Style TargetType="TextBlock" BasedOn="{StaticResource SectionPlaceholderTextStyle}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding HasSource}" Value="False">
                <Setter Property="Visibility" Value="Visible" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <TextBlock Text="Notes" Style="{StaticResource SectionHeaderTextStyle}" />
      <TextBlock Text="{Binding Entry.Notes}" Style="{StaticResource OptionalSectionTextStyle}" />
      <TextBlock Text="No notes recorded.">
        <TextBlock.Style>
          <Style TargetType="TextBlock" BasedOn="{StaticResource SectionPlaceholderTextStyle}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding HasNotes}" Value="False">
                <Setter Property="Visibility" Value="Visible" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <TextBlock Text="User notes" Style="{StaticResource SectionHeaderTextStyle}" />
      <TextBlock Text="{Binding Entry.UserNotes}" Style="{StaticResource OptionalSectionTextStyle}" />
      <TextBlock Text="No user notes provided.">
        <TextBlock.Style>
          <Style TargetType="TextBlock" BasedOn="{StaticResource SectionPlaceholderTextStyle}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding HasUserNotes}" Value="False">
                <Setter Property="Visibility" Value="Visible" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <TextBlock Text="Identifiers" Style="{StaticResource SectionHeaderTextStyle}" />
      <StackPanel>
        <TextBlock Visibility="{Binding HasInternalId, Converter={StaticResource BoolToVisibilityConverter}}">
          <Run Text="Internal ID: " />
          <Run Text="{Binding Entry.InternalId}" />
        </TextBlock>
        <TextBlock Visibility="{Binding HasDoi, Converter={StaticResource BoolToVisibilityConverter}}">
          <Run Text="DOI: " />
          <Run Text="{Binding Entry.Doi}" />
        </TextBlock>
        <TextBlock Visibility="{Binding HasPmid, Converter={StaticResource BoolToVisibilityConverter}}">
          <Run Text="PMID: " />
          <Run Text="{Binding Entry.Pmid}" />
        </TextBlock>
        <TextBlock Visibility="{Binding HasNct, Converter={StaticResource BoolToVisibilityConverter}}">
          <Run Text="NCT: " />
          <Run Text="{Binding Entry.Nct}" />
        </TextBlock>
      </StackPanel>
      <TextBlock Text="No identifiers recorded.">
        <TextBlock.Style>
          <Style TargetType="TextBlock" BasedOn="{StaticResource SectionPlaceholderTextStyle}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding HasIdentifiers}" Value="False">
                <Setter Property="Visibility" Value="Visible" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <TextBlock Text="Links" Style="{StaticResource SectionHeaderTextStyle}" />
      <ItemsControl ItemsSource="{Binding DataContext.LinkItems, RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                    Visibility="{Binding DataContext.HasLinkItems, RelativeSource={RelativeSource AncestorType=ScrollViewer}, Converter={StaticResource BoolToVisibilityConverter}}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <TextBlock Style="{StaticResource SectionTextStyle}" TextWrapping="Wrap">
              <Hyperlink Command="{Binding DataContext.OpenLinkCommand, RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                        CommandParameter="{Binding}"
                        ToolTip="{Binding Target}">
                <Run Text="{Binding DisplayText}" />
              </Hyperlink>
            </TextBlock>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
      <TextBlock Text="No links added.">
        <TextBlock.Style>
          <Style TargetType="TextBlock" BasedOn="{StaticResource SectionPlaceholderTextStyle}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding DataContext.HasLinkItems, RelativeSource={RelativeSource AncestorType=ScrollViewer}}" Value="False">
                <Setter Property="Visibility" Value="Visible" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <TextBlock Text="Attachments" Style="{StaticResource SectionHeaderTextStyle}" />
      <ItemsControl ItemsSource="{Binding Entry.Attachments}"
                    Visibility="{Binding HasAttachments, Converter={StaticResource BoolToVisibilityConverter}}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border BorderBrush="#FFE0E0E0"
                    BorderThickness="1"
                    Padding="8"
                    Margin="0,0,0,8">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                  <TextBlock Text="{Binding Title}" FontWeight="SemiBold" />
                  <TextBlock Text="{Binding RelativePath}" Style="{StaticResource OptionalSectionTextStyle}" />
                  <TextBlock Margin="0,4,0,0">
                    <Run Text="Type: " />
                    <Run Text="{Binding Kind}" />
                  </TextBlock>
                  <TextBlock Text="{Binding AddedBy, StringFormat=Added by {0}}"
                             Margin="0,2,0,0"
                             Style="{StaticResource OptionalSectionTextStyle}" />
                  <TextBlock Text="{Binding AddedUtc, StringFormat=Added on {0:yyyy-MM-dd HH:mm}}"
                             Margin="0,2,0,0" />
                  <TextBlock Text="{Binding Notes}" Style="{StaticResource AttachmentNotesTextStyle}" />
                  <TextBlock Style="{StaticResource AttachmentTagsTextStyle}">
                    <Run Text="Tags: " />
                    <Run Text="{Binding Tags, Converter={StaticResource StringJoinConverter}}" />
                  </TextBlock>
                </StackPanel>

                <Button Grid.Column="1"
                        Content="Open"
                        Command="{Binding DataContext.OpenAttachmentCommand, RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                        CommandParameter="{Binding}"
                        Padding="12,4"
                        Margin="12,0,0,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top" />
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
      <TextBlock Text="No attachments found.">
        <TextBlock.Style>
          <Style TargetType="TextBlock" BasedOn="{StaticResource SectionPlaceholderTextStyle}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding HasAttachments}" Value="False">
                <Setter Property="Visibility" Value="Visible" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>

      <TextBlock Text="Relations" Style="{StaticResource SectionHeaderTextStyle}" />
      <ItemsControl ItemsSource="{Binding Entry.Relations}"
                    Visibility="{Binding HasRelations, Converter={StaticResource BoolToVisibilityConverter}}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <TextBlock>
              <Run Text="{Binding Type}" FontWeight="SemiBold" />
              <Run Text=" → " />
              <Run Text="{Binding TargetEntryId}" />
            </TextBlock>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
      <TextBlock Text="No relations associated.">
        <TextBlock.Style>
          <Style TargetType="TextBlock" BasedOn="{StaticResource SectionPlaceholderTextStyle}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding HasRelations}" Value="False">
                <Setter Property="Visibility" Value="Visible" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
      </TextBlock>
    </StackPanel>
  </DataTemplate>
</ResourceDictionary>
