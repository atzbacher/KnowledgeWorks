<UserControl x:Class="LM.App.Wpf.Views.Library.TagTokenSelector"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignWidth="260"
             d:DesignHeight="120">
  <StackPanel>
    <Border BorderBrush="#FFD0D0D0" BorderThickness="1" CornerRadius="4" Padding="6">
      <StackPanel>
        <ItemsControl ItemsSource="{Binding SelectedTags, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      Margin="0,0,0,6">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border Background="#FFEEF2FF" CornerRadius="12" Margin="0,0,6,6" Padding="8,4">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                  <TextBlock Text="{Binding}" Margin="0,0,8,0" />
                  <Button Content="âœ•"
                          Width="18"
                          Height="18"
                          Padding="0"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          CommandParameter="{Binding}"
                          Click="OnRemoveTagClick"/>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
        <TextBox x:Name="InputBox"
                 Margin="0,0,0,0"
                 PreviewKeyDown="OnInputPreviewKeyDown"
                 TextChanged="OnInputTextChanged"
                 MinWidth="120"
                 ToolTip="Type to search tags. Press Enter, Tab, or comma to add."/>
      </StackPanel>
    </Border>
    <ListBox x:Name="SuggestionList"
             Margin="0,4,0,0"
             ItemsSource="{Binding FilteredSuggestions, RelativeSource={RelativeSource AncestorType=UserControl}}"
             PreviewMouseLeftButtonUp="OnSuggestionClick"
             PreviewKeyDown="OnSuggestionKeyDown"
             MaxHeight="160">
      <ListBox.Style>
        <Style TargetType="ListBox">
          <Setter Property="Visibility" Value="Collapsed" />
          <Setter Property="BorderThickness" Value="1" />
          <Setter Property="BorderBrush" Value="#FFD0D0D0" />
          <Setter Property="Background" Value="White" />
          <Style.Triggers>
            <DataTrigger Binding="{Binding HasItems, RelativeSource={RelativeSource Self}}" Value="True">
              <Setter Property="Visibility" Value="Visible" />
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </ListBox.Style>
    </ListBox>
  </StackPanel>
</UserControl>
